SYSTEM_PROMPT = """
Báº¡n Ä‘Æ°á»£c cung cáº¥p:
- Má»™t hoáº·c nhiá»u Ä‘oáº¡n vÄƒn báº£n (chunk) trÃ­ch tá»« tÃ i liá»‡u ká»¹ thuáº­t, kÃ¨m metadata: file, section, table_or_figure (náº¿u cÃ³), page.
- Má»™t yÃªu cáº§u ká»¹ thuáº­t cá»¥ thá»ƒ.

Nhiá»‡m vá»¥ cá»§a báº¡n:
1. XÃ¡c Ä‘á»‹nh thÃ´ng tin liÃªn quan trá»±c tiáº¿p Ä‘áº¿n yÃªu cáº§u trong cÃ¡c chunk Ä‘Æ°á»£c cung cáº¥p.
2. TrÃ­ch xuáº¥t chÃ­nh xÃ¡c giÃ¡ trá»‹/thÃ´ng sá»‘ Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ kháº£ nÄƒng Ä‘Ã¡p á»©ng:
   - Náº¿u khÃ´ng tÃ¬m tháº¥y thÃ´ng tin â†’ tráº£ vá» "".
   - Giá»¯ nguyÃªn cÃº phÃ¡p cá»§a yÃªu cáº§u ká»¹ thuáº­t, chá»‰ thay pháº§n thÃ´ng sá»‘ báº±ng giÃ¡ trá»‹ thá»±c táº¿ tá»« chunk.
   - KhÃ´ng bá»‹a Ä‘áº·t hoáº·c suy diá»…n.
   - Báº¯t buá»™c tráº£ lá»i báº±ng Tiáº¿ng Viá»‡t.

3. Cung cáº¥p dáº«n chá»©ng (metadata) cho tá»«ng pháº§n yÃªu cáº§u:
   - file: giá»¯ nguyÃªn nhÆ° metadata, náº¿u khÃ´ng cÃ³ â†’ "".
   - section: náº¿u khÃ´ng cÃ³ â†’ "".
   - table_or_figure: náº¿u khÃ´ng cÃ³ â†’ "".
   - page: náº¿u khÃ´ng cÃ³ â†’ 0.
   - evidence:
     + Náº¿u yÃªu cáº§u gá»“m nhiá»u pháº§n â†’ tÃ¡ch dáº«n chá»©ng cho tá»«ng pháº§n.
     + Dáº¡ng báº£ng/liá»‡t kÃª:
         * TrÃ­ch Ä‘Ãºng cá»¥m má»¥c vÃ  giÃ¡ trá»‹ cá»§a hÃ ng chá»©a thÃ´ng tin.
         * Náº¿u má»¥c nhiá»u cáº¥p â†’ ná»‘i cáº¥p báº±ng dáº¥u ":".
     + Dáº¡ng 1 má»¥c duy nháº¥t â†’ "Má»¥c: GiÃ¡ trá»‹".
     + Dáº¡ng vÄƒn báº£n thÆ°á»ng â†’ trÃ­ch nguyÃªn cÃ¢u hoáº·c Ä‘oáº¡n chá»©a thÃ´ng tin.
     + Giá»¯ nguyÃªn ngÃ´n ngá»¯ gá»‘c, khÃ´ng dá»‹ch
     + Náº¿u khÃ´ng cÃ³ thÃ´ng tin â†’ "".

Tráº£ káº¿t quáº£ báº±ng cÃ¡ch gá»i function `danh_gia_ky_thuat` vá»›i cÃ¡c tham sá»‘ phÃ¹ há»£p.
"""

# Äá»‹nh nghÄ©a function schema
FUNCTION_SCHEMA = {
    "name": "danh_gia_ky_thuat",
    "description": "ÄÃ¡nh giÃ¡ kháº£ nÄƒng Ä‘Ã¡p á»©ng cá»§a sáº£n pháº©m theo yÃªu cáº§u ká»¹ thuáº­t tá»« chunk tÃ i liá»‡u.",
    "parameters": {
        "type": "object",
        "properties": {
            "yeu_cau_ky_thuat": {
                "type": "string",
                "description": "YÃªu cáº§u ká»¹ thuáº­t cáº§n Ä‘Ã¡nh giÃ¡ (luÃ´n cÃ³ giÃ¡ trá»‹)."
            },
            "kha_nang_dap_ung": {
                "type": "string",
                "description": (
                    "Káº¿t quáº£ Ä‘Ã¡nh giÃ¡ báº±ng tiáº¿ng Viá»‡t, giá»¯ nguyÃªn cáº¥u trÃºc nhÆ° Ä‘oáº¡n máº«u, "
                    "hoáº·c chuá»—i rá»—ng náº¿u khÃ´ng cÃ³ thÃ´ng tin."
                )
            },
            "tai_lieu_tham_chieu": {
                "type": "object",
                "properties": {
                    "file": {
                        "type": "string",
                        "description": "TÃªn file chÃ­nh xÃ¡c tuyá»‡t Ä‘á»‘i hoáº·c chuá»—i rá»—ng náº¿u khÃ´ng cÃ³."
                    },
                    "section": {
                        "type": "string",
                        "description": "TÃªn section hoáº·c chuá»—i rá»—ng náº¿u khÃ´ng cÃ³."
                    },
                    "table_or_figure": {
                        "type": "string",
                        "description": "TÃªn báº£ng/hÃ¬nh náº¿u cÃ³, ngÆ°á»£c láº¡i Ä‘á»ƒ chuá»—i rá»—ng."
                    },
                    "page": {
                        "type": "integer",
                        "description": "Sá»‘ trang chá»©a thÃ´ng tin hoáº·c 0 náº¿u khÃ´ng xÃ¡c Ä‘á»‹nh."
                    },
                    "evidence": {
                        "type": "string",
                        "description": (
                            "NguyÃªn vÄƒn ná»™i dung trÃ­ch dáº«n. "
                            "Náº¿u trong báº£ng hoáº·c dáº¡ng liá»‡t kÃª nhiá»u cáº¥p, "
                            "giá»¯ nguyÃªn toÃ n bá»™ chuá»—i má»¥c + giÃ¡ trá»‹ (vÃ­ dá»¥: "
                            "'Others: Safety regulation: Conform to IEC60950-1 standards'). "
                            "Náº¿u khÃ´ng cÃ³ thÃ´ng tin â†’ chuá»—i rá»—ng."
                        )
                    }
                },
                "required": ["file", "section", "table_or_figure", "page", "evidence"]
            }
        },
        "required": ["yeu_cau_ky_thuat", "kha_nang_dap_ung", "tai_lieu_tham_chieu"]
    }
}


prompt = f"""
Báº¡n sáº½ Ä‘Æ°á»£c cung cáº¥p má»™t danh sÃ¡ch cÃ¡c cáº·p â€œyÃªu cáº§u ká»¹ thuáº­t || kháº£ nÄƒng Ä‘Ã¡p á»©ngâ€ trong file dap_ung_ky_thuat.
Nhiá»‡m vá»¥ cá»§a báº¡n:
1. Vá»›i tá»«ng cáº·p, Ä‘Ã¡nh giÃ¡ xem kháº£ nÄƒng Ä‘Ã¡p á»©ng cÃ³ thá»±c sá»± Ä‘Ã¡p á»©ng yÃªu cáº§u ká»¹ thuáº­t khÃ´ng.
2. Tá»•ng há»£p káº¿t quáº£:
  â€“ Náº¿u táº¥t cáº£ cÃ¡c yÃªu cáº§u Ä‘á»u Ä‘Æ°á»£c Ä‘Ã¡p á»©ng, tráº£ vá» "ÄÃ¡p á»©ng"
  â€“ Náº¿u khÃ´ng cÃ³ yÃªu cáº§u nÃ o Ä‘Æ°á»£c Ä‘Ã¡p á»©ng, tráº£ vá» "KhÃ´ng Ä‘Ã¡p á»©ng"
  â€“ Náº¿u chá»‰ má»™t pháº§n yÃªu cáº§u Ä‘Æ°á»£c Ä‘Ã¡p á»©ng, tráº£ vá» theo Ä‘á»‹nh dáº¡ng "ÄÃ¡p á»©ng: x/y = z%", trong Ä‘Ã³:
       - x lÃ  sá»‘ yÃªu cáº§u Ä‘Æ°á»£c Ä‘Ã¡p á»©ng
       - y lÃ  tá»•ng sá»‘ yÃªu cáº§u
       - z% lÃ  pháº§n trÄƒm lÃ m trÃ²n Ä‘áº¿n sá»‘ nguyÃªn gáº§n nháº¥t
ğŸ“¤ Káº¿t quáº£ chá»‰ tráº£ vá» dÆ°á»›i dáº¡ng JSON vá»›i cáº¥u trÃºc sau: {{
 "Ä‘Ã¡p á»©ng ká»¹ thuáº­t": "<káº¿t quáº£ Ä‘Ã¡nh giÃ¡>"
}}

Danh sÃ¡ch cÃ¡c cáº·p â€œyÃªu cáº§u ká»¹ thuáº­t || kháº£ nÄƒng Ä‘Ã¡p á»©ngâ€ : {dap_ung_ky_thuat}
"""